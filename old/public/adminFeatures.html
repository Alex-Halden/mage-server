<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>SAGE Features Administration Tool</title>

<!-- ExtJS -->
<link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css" />
<script type="text/javascript" src="extjs/ext-all.js"></script>

<script>
Ext.require([
    //'Ext.form.*',
    //'Ext.layout.container.Column',
    //'Ext.tab.Panel'
    '*'
]);

Ext.onReady(function() {
    Ext.QuickTips.init();
	
	var id = 0;

	Ext.define('Team', {
		extend: 'Ext.data.Model',
		fields: ['_id', 'team_name']
	});

	var teamStore = new Ext.data.Store({
		// store configs
		storeId: 'teamsStore',
		autoLoad: true,
		model: 'Team',
		proxy: {
			type: 'ajax',
			url: 'api/v1/teams',
			reader: {
				type: 'json'
			}
		}
	});
	
	Ext.define('ObservationLevel', {
		extend: 'Ext.data.Model',
		fields: ['_id', 'observation_level']
	});
	
	var observationLevelStore = new Ext.data.Store({
		// store configs
		storeId: 'observationLevelsStore',
		autoLoad: true,
		model: 'ObservationLevel',
		proxy: {
			type: 'ajax',
			url: 'api/v1/observationLevels',
			reader: {
				type: 'json'
			}
		}
	});
	
	Ext.define('ObservationType', {
		extend: 'Ext.data.Model',
		fields: ['_id', 'observation_type']
	});
	
	var observationTypeStore = new Ext.data.Store({
		// store configs
		storeId: 'observationTypesStore',
		autoLoad: true,
		model: 'ObservationType',
		proxy: {
			type: 'ajax',
			url: 'api/v1/observationTypes',
			reader: {
				type: 'json'
			}
		}
	});

									
	Ext.define('Features', {
		extend: 'Ext.data.Model',
		fields: ['OBJECTID', {name: 'EVENTDATE', type: 'date', dateFormat: 'u'}, 'TYPE', 'EVENTLEVEL']
	});
	
	var featuresStore = new Ext.data.Store({
		// store configs
		storeId: 'featuresStore',
		autoLoad: true,
		model: 'Features',
		proxy: {
			type: 'ajax',
			url: 'api/v1/features',
			reader: {
				type: 'json',
				record: 'attributes'
			}
		}
	});

	Ext.define('Attributes', {
		extend: 'Ext.data.Model',
		fields: ['ADDRESS', 'DESCRIPTION', 'EVENTCLEAR', {name: 'EVENTDATE', type: 'date', dateFormat: 'u'}, 'EVENTLEVEL', 'OBJECTID', 'TEAM', 'TYPE', 'UNIT', 'USNG']
	});

	
	var attributesStore = new Ext.data.Store({
		// store configs
		storeId: 'attributesStore',
		model: 'Attributes',
		proxy: {
			type: 'ajax',
			url: 'api/v1/features/' + id,
			reader: {
				type: 'json',
				record: 'attributes'
			}
		}
	});
		
	Ext.define('Geometry', {
		extend: 'Ext.data.Model',
		fields: ['x', 'y']
	});
	
	var geometryStore = new Ext.data.Store({
		// store configs
		storeId: 'geometryStore',
		model: 'Geometry',
		proxy: {
			type: 'ajax',
			url: 'api/v1/features/' + id,
			reader: {
				type: 'json',
				record: 'geometry'
			}
		}
	});
	
    var featuresGrid = Ext.create('Ext.grid.Panel', {
        store: featuresStore,
		selType: 'rowmodel',
        columns: [
            {text: "Object ID", dataIndex: 'OBJECTID'},
            {text: "Type", flex: 1, dataIndex: 'TYPE'},
            {text: "Event Level", dataIndex: 'EVENTLEVEL'},
            {text: "Date", renderer: Ext.util.Format.dateRenderer('m/d/Y'), dataIndex: 'EVENTDATE'}
        ],
		listeners: {
			selectionchange: function(model, records, row) {
				
				Ext.Msg.alert('Hello this is the title', records);
				
				console.log(row);
				
//				if (id != 0) {
//					attributesStore.load({url:'api/v1/features/'+ id});
//					geometryStore.load({url:'api/v1/features/' + id});
//				}
			}
		},

//        plugins: [{
//            ptype: 'rowexpander',
//            rowBodyTpl : [
//                '<p><b>Company:</b> {company}</p><br>',
//                '<p><b>Summary:</b> {desc}</p>'
//            ]
//        }],
        collapsible: true,
        animCollapse: false,
        title: 'SAGE ESRI Styled Features'
    });

    var viewport = Ext.create('Ext.Viewport', {
        layout: {
            type: 'border',
            padding: 5
        },
        defaults: {
            split: true
        },
        items: [{
            region: 'west',
            collapsible: false,
            //title: 'Starts at width 30%',
            split: true,
            width: '30%',
			splitterResize: false,
            //minWidth: 100,
            //minHeight: 140,
            items: [featuresGrid]
        },{
            region: 'east',
            collapsible: false,
            //title: 'Starts at width 30%',
            split: true,
            width: '30%',
			splitterResize: false,
            //minWidth: 100,
            //minHeight: 140,
            items: []
        },{
            region: 'center',
			layout: 'fit',
			frame: false,
			border: false,
            items: [{
				

	xtype: 'form',
	layout: 'form',
	collapsible: false,
	id: 'postFeatureForm',
	name: 'postFeatureForm',
	url: 'api/v1/esriFeatures/',
	frame: true,
	border: false,
	title: 'Feature Details',
	bodyPadding: '5 5 0',
	fieldDefaults: {
		msgTarget: 'side',
		labelWidth: 75
	},
	defaultType: 'textfield',
	items: [{
		fieldLabel: 'X',
		afterLabelTextTpl: required,
		name: 'x',
		allowBlank: false
	},{
		fieldLabel: 'Y',
		afterLabelTextTpl: required,
		name: 'y',
		allowBlank: false
	},{
		fieldLabel: 'Address',
		name: 'ADDRESS'
	}, {
		fieldLabel: 'Event Date',
		name: 'EVENTDATE',
		xtype: 'datefield',
		format: 'Y-m-d g:i:s A'
	}, {
		xtype: 'combobox',
		fieldLabel: 'Type',
		name: 'TYPE',
		store: observationTypeStore,
		valueField: 'observation_type',
		displayField: 'observation_type',
		typeAhead: true,
		queryMode: 'local',
		afterLabelTextTpl: required,
		emptyText: 'Select a Type...',
		allowBlank: false
	}, {
		xtype: 'combobox',
		fieldLabel: 'Level',
		name: 'EVENTLEVEL',
		store: observationLevelStore,
		valueField: 'observation_level',
		displayField: 'observation_level',
		typeAhead: true,
		queryMode: 'local',
		afterLabelTextTpl: required,
		emptyText: 'Select a Level...',
		allowBlank: false
	}, {
		xtype: 'combobox',
		fieldLabel: 'Team',
		name: 'TEAM',
		store: teamStore,
		valueField: 'team_name',
		displayField: 'team_name',
		typeAhead: true,
		queryMode: 'local',
		afterLabelTextTpl: required,
		emptyText: 'Select a team...',
		allowBlank: false
	}, {			
		fieldLabel: 'Description',
		name: 'DESCRIPTION'
	}, {			
		fieldLabel: 'USNG',
		name: 'USNG'
	}, {
		fieldLabel: 'Unit',
		name: 'UNIT'
	}, {
		xtype: 'hiddenfield',
		name: 'EVENTCLEAR',
		value: 0
	}],

	buttons: [{
		text: 'Save',
		handler: function() {
			this.up('form').getForm().isValid();
			
			//var myEpoch = myDate.getTime()/1000.0;
			
			postFeatureForm.getForm().submit();
		}
	},{
		text: 'Cancel',
		handler: function() {
			this.up('form').getForm().reset();
		}
	}]

				
			}]
        }]
    });

var required = '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';




});

</script>

</head>

</html>