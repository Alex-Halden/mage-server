<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>SAGE Post Attachment Tool</title>

<!-- ExtJS -->
<link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css" />
<script type="text/javascript" src="extjs/ext-all.js"></script>

<script>
Ext.require([
    //'Ext.form.*',
    //'Ext.layout.container.Column',
    //'Ext.tab.Panel'
    '*'
]);

Ext.onReady(function() {
    Ext.QuickTips.init();

Ext.define('Feature', {
    extend: 'Ext.data.Model',
    fields: ['OBJECTID']
});

var featureStore = new Ext.data.Store({
    // store configs
    storeId: 'featuresStore',
	autoLoad: true,
	model: 'Feature',
    proxy: {
        type: 'ajax',
        url: 'api/v1/getIDs',
        reader: {
            type: 'json',
			root: 'object_ids'
        }
    }
});

var required = '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';

var postAttachmentForm = Ext.widget({
	xtype: 'form',
	layout: 'form',
	style: 'margin:0 auto;margin-top:100px;',
	collapsible: false,
	id: 'postFeature',
	frame: true,
	title: 'Post a Feature',
	bodyPadding: '5 5 0',
	width: 500,
	fieldDefaults: {
		msgTarget: 'side',
		labelWidth: 100
	},
	defaultType: 'textfield',
	items: [{
		xtype: 'combobox',
		fieldLabel: 'Observation ID',
		name: 'observation_id',
		store: featureStore,
		valueField: 'OBJECTID',
		displayField: 'OBJECTID',
		typeAhead: true,
		queryMode: 'local',
		afterLabelTextTpl: required,
		emptyText: 'Select an Object ID...',
		allowBlank: false
        },{
		xtype: 'filefield',
		id: 'form-file',
		emptyText: 'Select a file',
		fieldLabel: 'Attachment',
		name: 'attachment',
		buttonText: '',
		buttonConfig: {
			iconCls: 'upload-icon'
		}
	}],
	buttons: [{
		text: 'Save',
		handler: function() {
			
		var chosenID = postAttachmentForm.getForm().findField('observation_id').getValue();
		
		postURL = 'api/v1/esriFeatures/' + chosenID + '/attachments';
								
			this.up('form').getForm().isValid();
			postAttachmentForm.getForm().submit({
				url     : postURL
//				,
//				success : onSuccessOrFail,
//				failure : onSuccessOrFail
			});
		}
	},{
		text: 'Cancel',
		handler: function() {
			this.up('form').getForm().reset();
		}
	}]
});

    postAttachmentForm.render(document.body);

});


</script>

</head>

</html>