<link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/resources/css/ext-all.css" />
<link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/examples/shared/examples.css" />

<script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js"></script>
<script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/ext-all.js"></script>
<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
<!--<script src='http://maps.google.com/maps?file=api&amp;v=3.2&amp;key=AIzaSyDBrM3tImC7V3T6IoDCZD_4_nF5eGusfHM'></script>-->
<script src='http://www.openlayers.org/dev/OpenLayers.js'></script>

<script type="text/javascript" src="geoext/script/GeoExt.js"></script>



<script>

var mapPanel;

Ext.onReady(function() {

	var options = {
		projection: new OpenLayers.Projection("EPSG:4326"),
		displayProjection: new OpenLayers.Projection("EPSG:4326"),
		units: "degrees",
		//units: "m",
		//maxResolution: 156543.0339,
		//maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34),
		controls: [
			new OpenLayers.Control.Navigation(),
			new OpenLayers.Control.PanZoomBar(),
			new OpenLayers.Control.LayerSwitcher({'ascending':true}),
			new OpenLayers.Control.Permalink(),
			new OpenLayers.Control.ScaleLine(),
			new OpenLayers.Control.Permalink('permalink'),
			new OpenLayers.Control.MousePosition(),
			//new OpenLayers.Control.OverviewMap(),
			new OpenLayers.Control.KeyboardDefaults()
		]
	};

	map = new OpenLayers.Map('map', options);

	var osmLayer = new OpenLayers.Layer.OSM("OpenStreetMap");

	// create Google Mercator layers
	var gmap = new OpenLayers.Layer.Google(
		"Google Streets",
		{'sphericalMercator': true,
		 'maxExtent': new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)
		}
	);
	
	var gphy = new OpenLayers.Layer.Google(
		"Google Physical",
		{type: google.maps.MapTypeId.TERRAIN}
		// used to be {type: G_PHYSICAL_MAP}
	);

	var ghyb = new OpenLayers.Layer.Google(
		"Google Hybrid",
		{type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20}
		// used to be {type: G_HYBRID_MAP, numZoomLevels: 20}
	);
	var gsat = new OpenLayers.Layer.Google(
		"Google Satellite",
		{type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22}
		// used to be {type: G_SATELLITE_MAP, numZoomLevels: 22}
	);

	var state = new OpenLayers.Layer.ArcGIS93Rest("US States & Counties", "http://sampleserver1.arcgisonline.com/ArcGIS/rest/***REMOVED***s/Specialty/ESRI_StateCityHighway_USA/MapServer/export", {
		layers: "show:2",
		transparent:true,
		isBaseLayer:false
	});
	state.setVisibility(false);
	
	var highways = new OpenLayers.Layer.ArcGIS93Rest("US Highways", "http://sampleserver1.arcgisonline.com/ArcGIS/rest/***REMOVED***s/Specialty/ESRI_StateCityHighway_USA/MapServer/export", {
		layers: "show:0",
		transparent:true,
		isBaseLayer:false
	});
	highways.setVisibility(false);
	
	var rivers = new OpenLayers.Layer.ArcGIS93Rest("US Rivers", "http://sampleserver1.arcgisonline.com/ArcGIS/rest/***REMOVED***s/Specialty/ESRI_StatesCitiesRivers_USA/MapServer/export", {
		layers: "show:1",
		transparent:true,
		isBaseLayer:false
	});
	rivers.setVisibility(false);

	var agsstreet = new OpenLayers.Layer.ArcGIS93Rest("ESRI Street Imagery","http://server.arcgisonline.com/ArcGIS/rest/***REMOVED***s/ESRI_StreetMap_World_2D/MapServer/export");
	agsstreet.params.FORMAT = "jpg";
	
	var agsimagery = new OpenLayers.Layer.ArcGIS93Rest("ESRI World Imagery","http://server.arcgisonline.com/ArcGIS/rest/***REMOVED***s/ESRI_Imagery_World_2D/MapServer/export");
	agsimagery.params.FORMAT = "jpg";

	var sageFeatures = new OpenLayers.Layer.Vector("vector", {projection: map.displayProjection,});

	var vector = new OpenLayers.Layer.Vector("GeoJSON", {
		projection: map.displayProjection,
		strategies: [new OpenLayers.Strategy.Fixed()],
		protocol: new OpenLayers.Protocol.HTTP({
			url: "./summits.json",
			format: new OpenLayers.Format.GeoJSON()
		})
	});

	var apiKey = "AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf";

	var hybrid = new OpenLayers.Layer.Bing({
		key: apiKey,
		type: "AerialWithLabels",
		name: "Bing Aerial With Labels"
	});
	    // create feature store, binding it to the vector layer
    store = new GeoExt.data.FeatureStore({
        //layer: sageFeatures,
        fields: [
            {name: 'name', type: 'string'},
            {name: 'elevation', type: 'float'}
        ],
        proxy: new GeoExt.data.ProtocolProxy({
            protocol: new OpenLayers.Protocol.HTTP({
                url: "./summits.json",
				format: new OpenLayers.Format.GeoJSON({
					projection: new OpenLayers.Projection("EPSG:4326")
				})
            })
        }),
        autoLoad: true
    });
	
	// override default epsg code
	aliasproj = new OpenLayers.Projection ("EPSG:4326");
	hybrid.projection = aliasproj;
	//osmLayer.projection = aliasproj;
	//gphy.projection = aliasproj;
	//gmap.projection = aliasproj;
	//ghyb.projection = aliasproj;
	//gsat.projection = aliasproj;
	//state.projection = aliasproj;
	//highways.projection = aliasproj;
	//rivers.projection = aliasproj;
	//agsstreet.projection = aliasproj;
	//agsimagery.projection = aliasproj;
	//sageFeatures.projection = aliasproj;
	

	// set transformation functions from/to alias projection
	//OpenLayers.Projection.addTransform("EPSG:4326", "EPSG:3857", OpenLayers.Layer.SphericalMercator.projectForward);
	OpenLayers.Projection.addTransform("EPSG:3857", "EPSG:4326", OpenLayers.Layer.SphericalMercator.projectInverse);	
		
	//map.addLayers([hybrid, agsstreet, agsimagery, osmLayer, gphy, gmap, ghyb, gsat, state, highways, rivers, sageFeatures]);
	map.addLayers([hybrid, osmLayer, gphy, gmap, ghyb, gsat]);
	
	var mappanel = new GeoExt.MapPanel({
		title: 'SAGE Mapping Tool',
		map: map,
		center: '-98.07495117187,40.661773681641',
		//center: new OpenLayers.LonLat(-98.07495117187,40.661773681641),
        zoom: 5,
		stateful: true,
		stateId: 'mappanel',
		dockedItems: [{
			xtype: 'toolbar',
			dock: 'top',
			items: [{
				text: 'Current center of the map',
				handler: function(){
					var c = GeoExt.panel.Map.guess().map.getCenter();
					Ext.Msg.alert(this.getText(), c.toString());
				}
			}]
		}]
	});

    // create grid panel configured with feature store
    gridPanel = new Ext.grid.GridPanel({
        title: "Feature Grid",
        region: "east",
        store: store,
        columns: [{
            header: "Name",
            width: 200,
            dataIndex: "name"
        }, {
            header: "Elevation",
            width: 100,
            dataIndex: "elevation"
        }],
        sm: new GeoExt.grid.FeatureSelectionModel() 
    });	
	
    new Ext.Viewport({
        layout: {
            type: 'border',
            padding: 5
        },
        defaults: {
            split: true
        },
        items: [{
            region: 'west',
            collapsible: false,
            //title: 'Starts at width 30%',
            split: true,
            width: '10%',
			splitterResize: false,
            //minWidth: 100,
            //minHeight: 140,
            items: []
        },{
            region: 'east',
            collapsible: false,
            //title: 'Starts at width 30%',
            split: true,
            width: '20%',
			splitterResize: false,
			layout: 'fit',
            //minWidth: 100,
            //minHeight: 140,
            items: [gridPanel]
        },{
            region: 'center',
			layout: 'fit',
			frame: false,
			border: true,
            items: [mappanel]
        }]
    });

    mapPanel = Ext.getCmp("mappanel");
});


</script>